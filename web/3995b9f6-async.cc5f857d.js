(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["3995b9f6"],{a8e90e34:function(e,t,a){"use strict";a.d(t,"__esModule",{value:!0}),a.d(t,"API",{enumerable:!0,get:function(){return o;}});var s=a("777fffbe")._(a("795f1363")),r=a("1fc97d93"),i=a("9a7ec01c"),l=a("23f8e02c");let o=s.default.create({baseURL:i.ENV.API_BASE_URL});o.interceptors.request.use(e=>{let t=(0,l.authHeader)();return e.headers&&"function"==typeof e.headers.set?t.Authorization&&e.headers.set("Authorization",t.Authorization):e.headers&&t.Authorization&&(e.headers.Authorization=t.Authorization),e;},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>((0,r.showError)(e),Promise.reject(e)));},dfe8a53d:function(e,t,a){a.d(t,"__esModule",{value:!0}),a.e(t,{default:function(){return W;}});var s=a("777fffbe"),r=a("852bbaa9"),i=a("26e051b7"),l=a("76b52bba"),o=r._(l),d=a("ae74910a"),n=a("a8e90e34"),f=a("dea4190d"),c=s._(f),u=a("0960755a"),g=s._(u);let{Text:h}=g.default,p=({messages:e,loading:t,onDelete:a})=>{let s=(0,d.useIntl)(),r=e=>({display:"flex",justifyContent:e?"flex-end":"flex-start",marginBottom:16}),l=e=>({backgroundColor:e?"#e6f4ff":"#f0f0f0",padding:"12px 16px",borderRadius:8,maxWidth:"70%"}),o={display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4};return(0,i.jsx)("div",{style:{flex:1,overflowY:"auto",padding:16},children:(0,i.jsx)(c.default,{loading:t,dataSource:e,locale:{emptyText:s.formatMessage({id:"pages.messageList.empty"})},renderItem:e=>{let t="user"===e.role,a="assistant"===e.role;return(0,i.jsx)("div",{style:r(t),children:(0,i.jsxs)("div",{style:l(t),children:[(0,i.jsxs)("div",{style:o,children:[(0,i.jsx)(h,{strong:!0,children:t?s.formatMessage({id:"pages.messageList.user"}):a?s.formatMessage({id:"pages.messageList.ai"}):e.role}),(0,i.jsx)(h,{type:"secondary",style:{fontSize:"12px"},children:e.createdAt})]}),(0,i.jsx)(h,{style:{whiteSpace:"pre-wrap",display:"block"},children:e.content})]})},e.id);}})});};var y=a("7e008f03"),x=s._(y),m=a("accfd539"),j=s._(m);let b=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),v=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),k=e=>{let t=v(e);return t.charAt(0).toUpperCase()+t.slice(1);},w=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),A=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0;};var _={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let C=(0,o.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:r="",children:i,iconNode:l,...d},n)=>(0,o.createElement)("svg",{ref:n,..._,width:t,height:t,stroke:e,strokeWidth:s?24*Number(a)/Number(t):a,className:w("lucide",r),...!i&&!A(d)&&{"aria-hidden":"true"},...d},[...l.map(([e,t])=>(0,o.createElement)(e,t)),...Array.isArray(i)?i:[i]])),M=((e,t)=>{let a=(0,o.forwardRef)(({className:a,...s},r)=>(0,o.createElement)(C,{ref:r,iconNode:t,className:w(`lucide-${b(k(e))}`,`lucide-${e}`,a),...s}));return a.displayName=k(e),a;})("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),{Title:S}=g.default,I=({conversations:e,selectedId:t,loading:a,onSelect:s,onDelete:r})=>{let l=(0,d.useIntl)(),o=e=>({padding:"12px 16px",cursor:"pointer",backgroundColor:e?"#e6f7ff":void 0,borderBottom:"1px solid #f0f0f0"}),n={backgroundColor:"#d9d9d9",color:"#fff",padding:"2px 8px",borderRadius:10,fontSize:12};return(0,i.jsxs)("div",{style:{width:400,backgroundColor:"#fff",borderRight:"1px solid #f0f0f0",display:"flex",flexDirection:"column",height:"100%"},children:[(0,i.jsx)("div",{style:{padding:16,borderBottom:"1px solid #f0f0f0",flexShrink:0,marginTop:32},children:(0,i.jsx)(S,{level:4,style:{margin:0},children:l.formatMessage({id:"pages.historyDialogs.title"})})}),(0,i.jsx)("div",{style:{flex:1,overflowY:"auto"},children:(0,i.jsx)(c.default,{loading:a&&0===e.length,dataSource:e,renderItem:e=>{var a;return(0,i.jsx)(c.default.Item,{style:o(t===e.id),onClick:()=>s(e),children:(0,i.jsxs)(j.default,{style:{flex:1,justifyContent:"space-between"},children:[(0,i.jsxs)(j.default,{children:[(0,i.jsxs)("span",{children:[(null===(a=e.date??e.createdAt)||void 0===a?void 0:a.replace("T"," ").slice(0,19))??"","....."]}),(0,i.jsx)(x.default,{type:"text",danger:!0,onClick:t=>{t.stopPropagation(),r(e.id);},icon:(0,i.jsx)(M,{size:16}),title:l.formatMessage({id:"pages.historyDialogs.delete.title"})})]}),(0,i.jsx)("div",{style:n,children:e.messageCount})]})},e.id);}})})]});};var D=a("dc9ef55b"),T=s._(D),z=a("98eafe66"),P=s._(z);let{Header:L,Content:$,Sider:B}=P.default,{Title:N,Text:R}=g.default,E=()=>{let e=(0,d.useLocation)(),t=(0,d.useParams)();return{...e.state&&"object"==typeof e.state?e.state:{},id:t.agentid};};function W(){var e;let t=(0,d.useIntl)(),a=E(),[s,r]=(0,o.useState)([]),[l,f]=(0,o.useState)([]),[c,u]=(0,o.useState)(null),[g,h]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{h(!0);try{let e=(await n.API.post(`/api/user/agent/history_dialog_list/${a.id}`)).data;"ok"===e.status&&Array.isArray(e.data)?r(e.data):r([]);}catch(e){r([]);}h(!1);})();},[a.id]);let y=async e=>{u(e),h(!0);try{let t=(await n.API.get(`/api/user/agent/history_dialog/${e.id}`)).data;if("ok"===t.status&&Array.isArray(JSON.parse(t.data.dialog))){let e=JSON.parse(t.data.dialog).flatMap(e=>{try{return[{role:e.role,content:e.content}];}catch{return[];}});f(e);}else f([]);}catch(e){f([]);}h(!1);},[x,m]=(0,o.useState)(!1),[j,b]=(0,o.useState)(null),v=async()=>{if(null!=j){try{await n.API.delete(`/api/user/agent/history_dialog/${j}`),r(s.filter(e=>e.id!==j)),(null==c?void 0:c.id)===j&&(u(null),f([]));}catch(e){}m(!1),b(null);}};return(0,i.jsxs)(P.default,{style:{height:"100vh",padding:24},children:[(0,i.jsx)("div",{style:{position:"absolute",top:16,left:32,zIndex:10},children:(0,i.jsxs)(R,{strong:!0,children:[t.formatMessage({id:"pages.historyDialogs.agent.label"})," ",a.name||""," ",a.id?`id: ${a.id}`:""]})}),(0,i.jsxs)(P.default,{style:{maxWidth:1800,width:"100%",height:"80vh",margin:"0 auto",background:"#fff",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)"},children:[(0,i.jsx)(B,{width:320,theme:"light",style:{borderRight:"1px solid #f0f0f0",overflowY:"auto"},children:(0,i.jsx)(I,{conversations:s,selectedId:null==c?void 0:c.id,loading:g,onSelect:y,onDelete:e=>{b(e),m(!0);}})}),(0,i.jsx)(P.default,{style:{background:"#fff"},children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(L,{style:{background:"#fff",padding:"16px 24px",height:"auto",borderBottom:"1px solid #f0f0f0"},children:(0,i.jsxs)(N,{level:4,style:{margin:0},children:[t.formatMessage({id:"pages.historyDialogs.detail.title"})," - ",(null===(e=c.date??c.createdAt)||void 0===e?void 0:e.replace("T"," ").slice(0,19))??""]})}),(0,i.jsx)($,{style:{padding:24,overflowY:"auto"},children:(0,i.jsx)(p,{messages:l,loading:g,onDelete:async e=>{if(window.confirm(t.formatMessage({id:"pages.historyDialogs.delete.content"})))try{await n.API.delete(`/api/user/agent/history_dialog/${e}`),f(t=>t.filter(t=>t.id!==e));}catch(e){}}})})]}):(0,i.jsx)($,{style:{display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa"},children:(0,i.jsx)(R,{type:"secondary",children:t.formatMessage({id:"pages.historyDialogs.empty.description"})})})})]}),(0,i.jsx)(T.default,{title:t.formatMessage({id:"pages.historyDialogs.delete.title"}),open:x,okButtonProps:{danger:!0},onCancel:()=>{m(!1),b(null);},onOk:v,okText:t.formatMessage({id:"pages.historyDialogs.delete.confirm"}),cancelText:t.formatMessage({id:"pages.historyDialogs.delete.cancel"}),children:(0,i.jsx)("p",{children:t.formatMessage({id:"pages.historyDialogs.delete.content"})})})]});}}}]);
//# sourceMappingURL=3995b9f6-async.cc5f857d.js.map