(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["46ced1e1"],{"8f1b75f4":function(e,s,a){"use strict";var t=a("852bbaa9")._;a.d(s,"__esModule",{value:!0}),a.d(s,"default",{enumerable:!0,get:function(){return v;}});var i=a("777fffbe"),n=a("26e051b7"),l=a("76b52bba"),r=i._(a("7201bd80")),d=i._(a("7e008f03")),o=i._(a("2888ea24")),u=i._(a("6a64c6d6")),c=i._(a("dc9ef55b")),m=i._(a("accfd539")),g=i._(a("13ed6381")),f=a("e54bf6aa"),h=a("ae74910a");let p=e=>e?e.replace(/^(.{3}).*(.{3})$/,"$1****$2"):"";var v=()=>{let e=(0,h.useIntl)(),[s,i]=(0,l.useState)(null),[v,b]=(0,l.useState)(!0),[x,j]=(0,l.useState)(!1),[y]=o.default.useForm(),[k,w]=(0,l.useState)(!1),[M,I]=(0,l.useState)(!1),{message:P}=g.default.useApp(),{initialState:_,setInitialState:C}=(0,h.useModel)("@@initialState"),T=(null==_?void 0:_.currentUser)||{};(0,l.useEffect)(()=>{S();},[]);let S=async()=>{b(!0);try{var s,n;let l=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:e})=>e.get("/api/user/profile"));(null==l?void 0:null===(s=l.data)||void 0===s?void 0:s.status)==="ok"?(i(l.data.data),C(e=>({...e,currentUser:l.data.data}))):P.error((null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||e.formatMessage({id:"pages.settings.fetchProfile.error"}));}catch(s){P.error(e.formatMessage({id:"pages.settings.fetchProfile.error"}));}b(!1);},A=async s=>{try{var i,n;let l=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:e})=>e.post("/api/user/change-password",{old_password:s.oldPassword,new_password:s.newPassword}));(null==l?void 0:null===(i=l.data)||void 0===i?void 0:i.status)==="ok"?(P.success(e.formatMessage({id:"pages.settings.password.changeSuccess"})),j(!1),y.resetFields()):P.error((null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||e.formatMessage({id:"pages.settings.password.changeError"}));}catch(s){P.error(e.formatMessage({id:"pages.settings.password.changeError"}));}},F=async()=>{c.default.confirm({title:e.formatMessage({id:"pages.settings.deleteAccount.confirmTitle"}),content:e.formatMessage({id:"pages.settings.deleteAccount.confirmContent"}),okText:e.formatMessage({id:"pages.settings.deleteAccount.confirm"}),okType:"danger",cancelText:e.formatMessage({id:"pages.settings.deleteAccount.cancel"}),onOk:async()=>{try{var s,i;let n=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:e})=>e.post("/api/user/delete"));(null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.status)==="ok"?(P.success(e.formatMessage({id:"pages.settings.deleteAccount.success"})),setTimeout(()=>{window.location.href="/login";},1500)):P.error((null==n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||e.formatMessage({id:"pages.settings.deleteAccount.error"}));}catch(s){P.error(e.formatMessage({id:"pages.settings.deleteAccount.error"}));}}});};return(0,n.jsxs)(f.PageContainer,{children:[(0,n.jsx)(r.default,{loading:v,title:e.formatMessage({id:"pages.settings.basicInfo.title"}),style:{marginBottom:24},children:T&&(0,n.jsxs)(m.default,{direction:"vertical",size:"middle",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{children:[e.formatMessage({id:"pages.settings.basicInfo.avatar"}),"\uFF1A"]}),(0,n.jsx)("img",{src:T.head_img?T.head_img:"https://ui-avatars.com/api/?name=User",alt:e.formatMessage({id:"pages.settings.basicInfo.avatar"}),style:{width:48,height:48,borderRadius:"50%",objectFit:"cover",border:"1px solid #eee",marginRight:16}})]}),(0,n.jsxs)("div",{children:[e.formatMessage({id:"pages.settings.basicInfo.username"}),"\uFF1A",(0,n.jsx)("span",{style:{fontWeight:"bold",fontSize:18},children:T.username})]}),(0,n.jsxs)("div",{children:[e.formatMessage({id:"pages.settings.basicInfo.nickname"}),"\uFF1A",(0,n.jsx)("span",{style:{fontWeight:"bold"},children:T.nickname||T.username}),(0,n.jsx)(d.default,{type:"link",size:"small",onClick:()=>w(!0),children:e.formatMessage({id:"pages.settings.basicInfo.editNickname"})}),(0,n.jsx)(c.default,{title:e.formatMessage({id:"pages.settings.basicInfo.editNicknameTitle"}),open:k,onCancel:()=>w(!1),footer:null,children:(0,n.jsxs)(o.default,{onFinish:async s=>{var i,n;let l=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:e})=>e.put("/api/user/profile",{nickname:s.name}));(null==l?void 0:null===(i=l.data)||void 0===i?void 0:i.status)==="ok"?(P.success(e.formatMessage({id:"pages.settings.basicInfo.nicknameChangeSuccess"})),w(!1),S(),C(e=>({...e,currentUser:{...e.currentUser,nickname:s.name}}))):P.error((null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.message)||e.formatMessage({id:"pages.settings.basicInfo.nicknameChangeError"}));},initialValues:{name:T.nickname},children:[(0,n.jsx)(o.default.Item,{label:e.formatMessage({id:"pages.settings.basicInfo.newNicknameLabel"}),name:"name",rules:[{required:!0,message:e.formatMessage({id:"pages.settings.basicInfo.newNicknameRequired"})},{min:2,max:20,message:e.formatMessage({id:"pages.settings.basicInfo.nicknameLength"})}],children:(0,n.jsx)(u.default,{})}),(0,n.jsx)(o.default.Item,{children:(0,n.jsx)(d.default,{type:"primary",htmlType:"submit",block:!0,children:e.formatMessage({id:"pages.settings.submit"})})})]})})]}),(0,n.jsxs)("div",{children:["\u6CE8\u518C\u65F6\u95F4\uFF1A",(null==s?void 0:s.created_at)?new Date(s.created_at).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-"):""]}),(0,n.jsxs)("div",{children:["\u90AE\u7BB1\uFF1A",(null==s?void 0:s.email)?(0,n.jsxs)(n.Fragment,{children:[s.email,(0,n.jsx)(d.default,{type:"link",size:"small",onClick:()=>I(!0),children:"\u4FEE\u6539\u7ED1\u5B9A\u90AE\u7BB1"}),(0,n.jsx)(c.default,{title:"\u4FEE\u6539\u7ED1\u5B9A\u90AE\u7BB1",open:M,onCancel:()=>I(!1),footer:null,children:(0,n.jsxs)(o.default,{onFinish:async e=>{var s,i;let n=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:s})=>s.put("/api/user/profile",{email:e.email}));(null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.status)==="ok"?(P.success("\u90AE\u7BB1\u7ED1\u5B9A\u6210\u529F"),I(!1),S()):P.error((null==n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||"\u7ED1\u5B9A\u5931\u8D25");},initialValues:{email:null==s?void 0:s.email},children:[(0,n.jsx)(o.default.Item,{label:"\u90AE\u7BB1",name:"email",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{type:"email",message:"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"}],children:(0,n.jsx)(u.default,{})}),(0,n.jsx)(o.default.Item,{children:(0,n.jsx)(d.default,{type:"primary",htmlType:"submit",block:!0,children:"\u63D0\u4EA4"})})]})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{style:{color:"red"},children:"\u672A\u7ED1\u5B9A"}),(0,n.jsx)(d.default,{type:"link",size:"small",onClick:()=>I(!0),children:"\u7ED1\u5B9A\u90AE\u7BB1"}),(0,n.jsx)(c.default,{title:"\u7ED1\u5B9A\u90AE\u7BB1",open:M,onCancel:()=>I(!1),footer:null,children:(0,n.jsxs)(o.default,{onFinish:async e=>{var s,i;let n=await Promise.all([a.ensure("vendors"),a.ensure("common"),a.ensure("a8e90e34")]).then(a.dr(t,a.bind(a,"a8e90e34"))).then(({API:s})=>s.put("/api/user/profile",{email:e.email}));(null==n?void 0:null===(s=n.data)||void 0===s?void 0:s.status)==="ok"?(P.success("\u90AE\u7BB1\u7ED1\u5B9A\u6210\u529F"),I(!1),S()):P.error((null==n?void 0:null===(i=n.data)||void 0===i?void 0:i.message)||"\u7ED1\u5B9A\u5931\u8D25");},children:[(0,n.jsx)(o.default.Item,{label:"\u90AE\u7BB1",name:"email",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},{type:"email",message:"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E"}],children:(0,n.jsx)(u.default,{})}),(0,n.jsx)(o.default.Item,{children:(0,n.jsx)(d.default,{type:"primary",htmlType:"submit",block:!0,children:"\u63D0\u4EA4"})})]})})]})]}),(null==s?void 0:s.OpenID)&&(0,n.jsxs)("div",{children:["OpenID\uFF1A",p(s.OpenID)]})]})}),(0,n.jsxs)(r.default,{title:e.formatMessage({id:"pages.settings.password.title"}),style:{marginBottom:24},children:[(0,n.jsx)(d.default,{type:"primary",onClick:()=>j(!0),children:"\u4FEE\u6539\u5BC6\u7801"}),(0,n.jsx)(c.default,{title:"\u4FEE\u6539\u5BC6\u7801",open:x,onCancel:()=>j(!1),footer:null,children:(0,n.jsxs)(o.default,{form:y,onFinish:A,layout:"vertical",children:[(0,n.jsx)(o.default.Item,{label:"\u65E7\u5BC6\u7801",name:"oldPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65E7\u5BC6\u7801"}],children:(0,n.jsx)(u.default.Password,{})}),(0,n.jsx)(o.default.Item,{label:"\u65B0\u5BC6\u7801",name:"newPassword",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"},{min:6,message:"\u65B0\u5BC6\u7801\u957F\u5EA6\u81F3\u5C116\u4F4D"}],children:(0,n.jsx)(u.default.Password,{})}),(0,n.jsx)(o.default.Item,{label:"\u786E\u8BA4\u65B0\u5BC6\u7801",name:"confirmPassword",dependencies:["newPassword"],rules:[{required:!0,message:"\u8BF7\u786E\u8BA4\u65B0\u5BC6\u7801"},({getFieldValue:e})=>({validator:(s,a)=>a&&e("newPassword")!==a?Promise.reject(Error("\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u4E00\u81F4")):Promise.resolve()})],children:(0,n.jsx)(u.default.Password,{})}),(0,n.jsx)(o.default.Item,{children:(0,n.jsx)(d.default,{type:"primary",htmlType:"submit",block:!0,children:"\u63D0\u4EA4"})})]})})]}),(0,n.jsx)(r.default,{title:e.formatMessage({id:"pages.settings.deleteAccount.title"}),children:(0,n.jsx)(d.default,{danger:!0,onClick:F,children:"\u5220\u9664\u8D26\u53F7"})})]});};}}]);
//# sourceMappingURL=46ced1e1-async.aa4a178e.js.map