(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["87a1c0aa"],{"37a9ee86":function(e,a,t){t.d(a,"__esModule",{value:!0}),t.e(a,{default:function(){return B;}});var s=t("777fffbe"),l=t("852bbaa9"),n=t("26e051b7"),g=t("76b52bba"),i=l._(g),o=t("ae74910a"),r=t("e54bf6aa"),d=t("985b35bf"),u=t("7e008f03"),p=s._(u),f=t("2888ea24"),c=s._(f),m=t("6a64c6d6"),h=s._(m),v=t("8f49028c"),S=s._(v),M=t("cde5b04e"),b=s._(M),y=t("78d99ba6"),j=s._(y),x=t("e081a98a"),T=s._(x),L=t("e27282e4"),w=s._(L),_=t("accfd539"),A=s._(_),N=t("a8e90e34"),k=t("872dc481"),C=s._(k),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},I=t("f53a241d"),P=s._(I),F=i.forwardRef(function(e,a){return i.createElement(P.default,(0,C.default)({},e,{ref:a,icon:V}));}),E=t("9acd0375");let D={labelCol:{span:6},wrapperCol:{span:18}},B=()=>{let e=(0,o.useNavigate)(),a=(0,o.useIntl)(),t=(0,o.useLocation)(),[s]=c.default.useForm(),[l,g]=(0,i.useState)(!1),[u,f]=(0,i.useState)(null),[m,v]=(0,i.useState)([]),[M,y]=(0,i.useState)([]),[x,L]=(0,i.useState)([]),[_,k]=(0,i.useState)([]),[C,V]=(0,i.useState)(""),[I,P]=(0,i.useState)([]);i.default.useEffect(()=>{(async()=>{try{let e=await fetch("/role_template.json",{cache:"no-cache"});if(!e.ok)throw Error(`HTTP ${e.status}`);let a=await e.json();Array.isArray(a)&&P(a.filter(e=>e&&e.name&&e.prompt));}catch(e){console.error("AgentSetting: failed to load role_template.json",e);}})();},[]),i.default.useEffect(()=>{(async()=>{try{let e=await E.systemApi.getProvidersByType("TTS"),a=[],l=new Set;e.forEach(e=>{var t,s,n;let g=(null===(t=e.config)||void 0===t?void 0:t.supported_voices)||(null===(s=e.config)||void 0===s?void 0:s.surported_voices)||(null===(n=e.config)||void 0===n?void 0:n.supportedVoices)||null;Array.isArray(g)&&g.forEach(e=>{var t;let s="string"==typeof e?e:(null==e?void 0:e.name)||"",n="string"==typeof e?e:(null==e?void 0:e.display_name)||(null==e?void 0:e.name)||s,g="object"==typeof e&&(null==e?void 0:null===(t=e.language)||void 0===t?void 0:t.trim())?e.language.trim():"\u666E\u901A\u8BDD";a.push({value:s,label:n,language:g}),l.add(g);});}),y(a);let n=Array.from(l);n.sort((e,a)=>"\u666E\u901A\u8BDD"===e?-1:"\u666E\u901A\u8BDD"===a?1:"\u82F1\u8BED"===e?-1:"\u82F1\u8BED"===a?1:0),k(n.map(e=>({value:e,label:e})));let g=(null==t?void 0:t.state)||{},i=u||g||{},o=i.avatar||i.voice||i.voiceType;if(o){let e=a.find(e=>e.value===o);if(e){let a=e.label,t=i.voiceName||"";a!==t&&console.log("AgentSetting: voice name mismatch between TTS catalog and server:",{voiceId:o,ttsName:a,serverName:t}),V(e.language||i.language||n[0]||"\u666E\u901A\u8BDD"),s.setFieldsValue({voiceType:o,voiceName:a,dialogLanguage:e.language||i.language});}else{let e=i.language;V(e||n[0]||"\u666E\u901A\u8BDD"),e&&s.setFieldsValue({dialogLanguage:e});}}else{let e=i.language;V(e||n[0]||"\u666E\u901A\u8BDD"),e&&s.setFieldsValue({dialogLanguage:e});}}catch(e){console.error(a.formatMessage({id:"pages.agentSetting.load.tts.error",defaultMessage:"\u52A0\u8F7DTTS\u97F3\u8272\u5931\u8D25"}),e);}})();},[a,u]),i.default.useEffect(()=>{if(!C){L([]);return;}let e=M.filter(e=>e.language===C);L(e.map(e=>({value:e.value,label:e.label})));let a=s.getFieldValue("voiceType");e.some(e=>e.value===a)||(e.length>0?s.setFieldsValue({voiceType:e[0].value}):s.setFieldsValue({voiceType:void 0}));},[M,C,s]),i.default.useEffect(()=>{E.systemApi.getProvidersByType("LLM").then(e=>{v(e.map(e=>{var a;return{value:e.name,label:(null===(a=e.config)||void 0===a?void 0:a.model)?`${e.name} (${e.config.model})`:e.name};}));});},[]);let B=t.state||{},[q,z]=(0,i.useState)({template:1,assistantName:B.name,dialogLanguage:B.language,voiceType:B.avatar,roleDescription:B.prompt,languageModel:B.LLM,recognitionSpeed:1===B.asrSpeed?"slow":2===B.asrSpeed?"normal":3===B.asrSpeed?"fast":"normal",speechSpeed:1===B.speakSpeed?"slow":2===B.speakSpeed?"normal":3===B.speakSpeed?"fast":"normal",pitchValue:"number"==typeof B.tone?B.tone:50,voiceName:B.voiceName||""});i.default.useEffect(()=>{(async()=>{try{var e;let a=t.state||{},l=new URLSearchParams(t.search||""),n=a.id||l.get("id");if(!n)return;let g=await N.API.get(`/api/user/agent/${n}`);if(null==g?void 0:null===(e=g.data)||void 0===e?void 0:e.data){let e=g.data.data;f(e);let a={assistantName:e.name,languageModel:e.LLM,dialogLanguage:e.language,voiceType:e.voice,recognitionSpeed:1===e.asrSpeed?"slow":2===e.asrSpeed?"normal":"fast",speechSpeed:1===e.speakSpeed?"slow":2===e.speakSpeed?"normal":"fast",pitchValue:e.tone??50,roleDescription:e.prompt,template:1,voiceName:e.voiceName||""};z(a),s.setFieldsValue(a);}}catch(e){console.error("AgentSetting: failed to fetch agent by id",e);}})();},[]),i.default.useEffect(()=>{if(B.language&&B.avatar&&B.LLM&&B.prompt&&B.voice&&B.voiceName&&B.asrSpeed&&B.speakSpeed&&"number"==typeof B.tone||!B.id)return;},[B]),i.default.useEffect(()=>{if(!B.avatar||0===M.length)return;let e=M.find(e=>e.value===B.avatar);e&&V(e.language);},[B.avatar,M]);let $=e=>{let a=s.getFieldValue("assistantName")||"",t=(e.prompt||"").replace(/\{\{\s*assistant_name\s*\}\}/g,a);s.setFieldsValue({template:e.name,roleDescription:t});},R=async()=>{try{var e;let t=await s.validateFields();if(!B.id){w.default.error(a.formatMessage({id:"pages.agentSetting.save.missingId",defaultMessage:"\u7F3A\u5C11 agent id\uFF0C\u65E0\u6CD5\u4FDD\u5B58"}));return;}let l=M.find(e=>e.value===t.voiceType),n=(null==l?void 0:l.label)||t.voiceName||"",g={prompt:t.roleDescription,name:t.assistantName,LLM:t.languageModel,language:t.dialogLanguage,voice:t.voiceType,voiceName:n,asrSpeed:"slow"===t.recognitionSpeed?1:"normal"===t.recognitionSpeed?2:3,speakSpeed:"slow"===t.speechSpeed?1:"normal"===t.speechSpeed?2:3,tone:Number(t.pitchValue)};console.log("AgentSetting: uploading payload for agent",B.id,g),await N.API.put(`/api/user/agent/${B.id}`,g,{headers:{"Content-Type":"application/json"}}),w.default.success(a.formatMessage({id:"pages.agentSetting.save.success",defaultMessage:"\u4FDD\u5B58\u6210\u529F"}));let i=await N.API.get(`/api/user/agent/${B.id}`);if(null==i?void 0:null===(e=i.data)||void 0===e?void 0:e.data){let e=i.data.data,a={assistantName:e.name,languageModel:e.LLM,dialogLanguage:e.language,voiceType:e.voice,recognitionSpeed:1===e.asrSpeed?"slow":2===e.asrSpeed?"normal":"fast",speechSpeed:1===e.speakSpeed?"slow":2===e.speakSpeed?"normal":"fast",pitchValue:e.tone,roleDescription:e.prompt,template:1};z(a),s.setFieldsValue(a);}}catch(e){w.default.error(a.formatMessage({id:"pages.agentSetting.save.error",defaultMessage:"\u4FDD\u5B58\u5931\u8D25"}));}};return(0,n.jsx)(r.PageContainer,{header:{title:(0,n.jsxs)("span",{children:[(0,n.jsx)(p.default,{type:"text",icon:(0,n.jsx)(F,{}),onClick:()=>e("/console/agents"),style:{marginRight:8}}),a.formatMessage({id:"pages.agentSetting.title",defaultMessage:"\u914D\u7F6E\u89D2\u8272"})]}),breadcrumb:void 0},children:(0,n.jsx)(d.ProCard,{children:(0,n.jsxs)(c.default,{...D,form:s,initialValues:q,children:[(0,n.jsx)(d.ProCard,{title:a.formatMessage({id:"pages.agentSetting.roleTemplate.title",defaultMessage:"\u89D2\u8272\u6A21\u677F"}),bordered:!0,style:{marginBottom:24},children:(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.roleTemplate.label",defaultMessage:"\u6A21\u677F"}),name:"template",children:(0,n.jsx)(j.default,{gutter:[8,8],children:I.length>0?I.map(e=>(0,n.jsx)(T.default,{children:(0,n.jsx)(p.default,{type:s.getFieldValue("template")===e.name?"primary":"default",onClick:()=>$(e),children:e.name})},e.name)):(0,n.jsx)(T.default,{children:(0,n.jsx)("span",{style:{color:"#999"},children:a.formatMessage({id:"pages.agentSetting.roleTemplate.empty",defaultMessage:"\u6682\u65E0\u6A21\u677F\uFF0C\u8BF7\u68C0\u67E5 role_template.json"})})})})})}),(0,n.jsxs)(d.ProCard,{title:a.formatMessage({id:"pages.agentSetting.basicConfig.title",defaultMessage:"\u57FA\u7840\u914D\u7F6E"}),bordered:!0,style:{marginBottom:24},children:[(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.assistantName.label",defaultMessage:"\u52A9\u624B\u6635\u79F0"}),name:"assistantName",rules:[{required:!0,message:a.formatMessage({id:"pages.agentSetting.assistantName.required",defaultMessage:"\u8BF7\u8F93\u5165\u52A9\u624B\u6635\u79F0"})}],children:(0,n.jsx)(h.default,{placeholder:a.formatMessage({id:"pages.agentSetting.assistantName.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u52A9\u624B\u6635\u79F0"})})}),(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.dialogLanguage.label",defaultMessage:"\u5BF9\u8BDD\u8BED\u8A00"}),name:"dialogLanguage",rules:[{required:!0}],children:(0,n.jsx)(S.default,{options:(()=>{let e={\u666E\u901A\u8BDD:"pages.agentSetting.language.chinese",\u82F1\u8BED:"pages.agentSetting.language.english",\u897F\u73ED\u7259\u8BED:"pages.agentSetting.language.spanish",\u6CD5\u8BED:"pages.agentSetting.language.french",\u5FB7\u8BED:"pages.agentSetting.language.german",\u65E5\u8BED:"pages.agentSetting.language.japanese",\u97E9\u8BED:"pages.agentSetting.language.korean",\u8461\u8404\u7259\u8BED:"pages.agentSetting.language.portuguese",\u963F\u62C9\u4F2F\u8BED:"pages.agentSetting.language.arabic",\u4FC4\u8BED:"pages.agentSetting.language.russian",\u610F\u5927\u5229\u8BED:"pages.agentSetting.language.italian",\u571F\u8033\u5176\u8BED:"pages.agentSetting.language.turkish",\u6CE2\u5170\u8BED:"pages.agentSetting.language.polish"};return _.map(t=>{let s=e[t.value],l=s?a.formatMessage({id:s,defaultMessage:t.value}):t.value;return{value:t.value,label:l};});})(),value:C,onChange:e=>V(e),placeholder:a.formatMessage({id:"pages.agentSetting.dialogLanguage.placeholder",defaultMessage:"\u9009\u62E9\u5BF9\u8BDD\u8BED\u8A00"})})}),(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.voiceType.label",defaultMessage:"\u89D2\u8272\u97F3\u8272"}),name:"voiceType",rules:[{required:!0}],children:(0,n.jsx)(S.default,{options:x,placeholder:a.formatMessage({id:"pages.agentSetting.voiceType.placeholder",defaultMessage:"\u9009\u62E9\u89D2\u8272\u97F3\u8272"})})})]}),(0,n.jsx)(d.ProCard,{title:a.formatMessage({id:"pages.agentSetting.roleDescription.title",defaultMessage:"\u89D2\u8272\u4ECB\u7ECD"}),bordered:!0,style:{marginBottom:24},children:(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.roleDescription.label",defaultMessage:"\u89D2\u8272\u4ECB\u7ECD"}),name:"roleDescription",rules:[{required:!0,message:a.formatMessage({id:"pages.agentSetting.roleDescription.required",defaultMessage:"\u8BF7\u8F93\u5165\u89D2\u8272\u4ECB\u7ECD"})}],children:(0,n.jsx)(h.default.TextArea,{rows:5,maxLength:2e3,showCount:!0,placeholder:a.formatMessage({id:"pages.agentSetting.roleDescription.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u89D2\u8272\u4ECB\u7ECD"})})})}),(0,n.jsxs)(d.ProCard,{title:a.formatMessage({id:"pages.agentSetting.languageModel.title",defaultMessage:"\u8BED\u8A00\u6A21\u578B"}),bordered:!0,style:{marginBottom:24},children:[(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.languageModel.label",defaultMessage:"\u8BED\u8A00\u6A21\u578B"}),name:"languageModel",rules:[{required:!0}],children:(0,n.jsx)(S.default,{options:m,placeholder:a.formatMessage({id:"pages.agentSetting.languageModel.placeholder",defaultMessage:"\u9009\u62E9\u8BED\u8A00\u6A21\u578B"})})}),(0,n.jsx)("div",{style:{color:"#888",fontSize:12,marginLeft:100},children:a.formatMessage({id:"pages.agentSetting.languageModel.tip",defaultMessage:"\u6539\u53D8\u6A21\u578B\u540E\uFF0C\u5EFA\u8BAE\u6E05\u7A7A\u8BB0\u5FC6\u4F53\uFF0C\u4EE5\u514D\u5F71\u54CD\u804A\u5929\u4F53\u9A8C\u3002"})})]}),(0,n.jsxs)(d.ProCard,{title:(0,n.jsx)(p.default,{type:"link",onClick:()=>g(!l),style:{padding:0},children:l?a.formatMessage({id:"pages.agentSetting.advancedSettings.collapse",defaultMessage:"\u6536\u8D77\u9AD8\u7EA7\u8BBE\u7F6E"}):a.formatMessage({id:"pages.agentSetting.advancedSettings.expand",defaultMessage:"\u5C55\u5F00\u9AD8\u7EA7\u8BBE\u7F6E"})}),bordered:!0,collapsible:!0,collapsed:!l,style:{marginBottom:24},children:[(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.recognitionSpeed.label",defaultMessage:"\u8BED\u97F3\u8BC6\u522B\u901F\u5EA6"}),name:"recognitionSpeed",children:(0,n.jsx)(S.default,{options:[{value:"normal",label:a.formatMessage({id:"pages.agentSetting.speed.normal",defaultMessage:"\u6B63\u5E38"})},{value:"slow",label:a.formatMessage({id:"pages.agentSetting.speed.patient",defaultMessage:"\u8010\u5FC3"})},{value:"fast",label:a.formatMessage({id:"pages.agentSetting.speed.fast",defaultMessage:"\u5FEB\u901F"})}],placeholder:a.formatMessage({id:"pages.agentSetting.recognitionSpeed.placeholder",defaultMessage:"\u9009\u62E9\u8BC6\u522B\u901F\u5EA6"})})}),(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.speechSpeed.label",defaultMessage:"\u89D2\u8272\u8BED\u901F"}),name:"speechSpeed",children:(0,n.jsx)(S.default,{options:[{value:"normal",label:a.formatMessage({id:"pages.agentSetting.speed.normal",defaultMessage:"\u6B63\u5E38"})},{value:"slow",label:a.formatMessage({id:"pages.agentSetting.speed.slow",defaultMessage:"\u6162\u901F"})},{value:"fast",label:a.formatMessage({id:"pages.agentSetting.speed.fast",defaultMessage:"\u5FEB\u901F"})}],placeholder:a.formatMessage({id:"pages.agentSetting.speechSpeed.placeholder",defaultMessage:"\u9009\u62E9\u8BED\u901F"})})}),(0,n.jsx)(c.default.Item,{label:a.formatMessage({id:"pages.agentSetting.pitchValue.label",defaultMessage:"\u89D2\u8272\u97F3\u8C03"}),name:"pitchValue",children:(0,n.jsx)(h.default,{type:"range",min:0,max:100})})]}),(0,n.jsx)(b.default,{}),(0,n.jsx)(c.default.Item,{wrapperCol:{offset:6,span:18},children:(0,n.jsxs)(A.default,{children:[(0,n.jsx)(p.default,{onClick:()=>{s.resetFields(),s.setFieldsValue(q);},children:a.formatMessage({id:"pages.agentSetting.button.reset",defaultMessage:"\u91CD\u7F6E"})}),(0,n.jsx)(p.default,{type:"primary",onClick:R,children:a.formatMessage({id:"pages.agentSetting.button.save",defaultMessage:"\u4FDD\u5B58"})})]})})]})})});};},a8e90e34:function(e,a,t){"use strict";t.d(a,"__esModule",{value:!0}),t.d(a,"API",{enumerable:!0,get:function(){return i;}});var s=t("777fffbe")._(t("795f1363")),l=t("1fc97d93"),n=t("9a7ec01c"),g=t("23f8e02c");let i=s.default.create({baseURL:n.ENV.API_BASE_URL});i.interceptors.request.use(e=>{let a=(0,g.authHeader)();return e.headers&&"function"==typeof e.headers.set?a.Authorization&&e.headers.set("Authorization",a.Authorization):e.headers&&a.Authorization&&(e.headers.Authorization=a.Authorization),e;},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>((0,l.showError)(e),Promise.reject(e)));}}]);
//# sourceMappingURL=87a1c0aa-async.2a122b85.js.map