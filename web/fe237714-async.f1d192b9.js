(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["fe237714"],{"9ea97d54":function(e,a,s){"use strict";s.d(a,"__esModule",{value:!0}),s.d(a,"default",{enumerable:!0,get:function(){return L;}});var t=s("777fffbe"),n=s("26e051b7"),r=s("76b52bba"),l=t._(s("8ca22198")),i=s("ae74910a"),d=t._(s("03015425")),o=s("a8e90e34"),g=s("9acd0375"),c=s("e54bf6aa"),u=s("985b35bf"),f=t._(s("7e008f03")),p=t._(s("e081a98a")),h=t._(s("cde5b04e")),m=t._(s("2888ea24")),M=t._(s("6a64c6d6")),v=t._(s("e27282e4")),y=t._(s("dc9ef55b")),x=t._(s("78d99ba6")),j=t._(s("accfd539")),C=t._(s("c115c636")),_=t._(s("3ba66d86")),A=t._(s("885c9025")),I=t._(s("71c2f61d"));let b=e=>{v.default.info(e.formatMessage({id:"pages.agents.addDevice.personalUnsupported",defaultMessage:"\u793E\u533A\u7248\u672C\u4E0D\u652F\u6301\u7ED1\u5B9A\u8BBE\u5907"}));},S=({onCreateAgent:e,onAddDevice:a})=>{let[s,t]=(0,r.useState)(""),l=(0,i.useIntl)();return(0,n.jsxs)(j.default,{size:16,children:[(0,n.jsx)(M.default,{prefix:(0,n.jsx)(A.default,{}),placeholder:l.formatMessage({id:"pages.agents.search.placeholder",defaultMessage:"\u641C\u7D22\u667A\u80FD\u4F53"}),value:s,onChange:e=>t(e.target.value),style:{width:250}}),(0,n.jsx)(f.default,{type:"primary",icon:(0,n.jsx)(_.default,{}),onClick:e,children:l.formatMessage({id:"pages.agents.create.button",defaultMessage:"\u65B0\u5EFA\u667A\u80FD\u4F53"})}),(0,n.jsx)(f.default,{type:"default",onClick:a,children:l.formatMessage({id:"pages.agents.addDevice.button",defaultMessage:"\u6DFB\u52A0\u8BBE\u5907"})})]});},k=({agent:e,onDelete:a,onRefresh:s,fullAgent:t})=>{let l=(0,i.useNavigate)(),[g,c]=(0,r.useState)(!1),p=(0,i.useIntl)();return(0,n.jsxs)(u.ProCard,{hoverable:!0,style:{minWidth:300,margin:5},title:(0,n.jsxs)(j.default,{children:[(0,n.jsx)("span",{children:e.name}),(0,n.jsxs)("span",{style:{fontSize:12,color:"#999"},children:[p.formatMessage({id:"pages.agents.card.id",defaultMessage:"ID"}),": ",e.id]})]}),extra:(0,n.jsx)(f.default,{type:"text",danger:!0,icon:(0,n.jsx)(C.default,{}),onClick:()=>a(e)}),children:[(0,n.jsxs)(j.default,{direction:"vertical",style:{width:"100%"},children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{style:{color:"#666"},children:[p.formatMessage({id:"pages.agents.card.voiceModel",defaultMessage:"\u89D2\u8272\u97F3\u8272"}),":"]}),(0,n.jsx)("span",{style:{marginLeft:8},children:e.avatar})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{style:{color:"#666"},children:[p.formatMessage({id:"pages.agents.card.languageModel",defaultMessage:"\u8BED\u8A00\u6A21\u578B"}),":"]}),(0,n.jsx)("span",{style:{marginLeft:8},children:e.voiceModel})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("span",{style:{color:"#666"},children:[p.formatMessage({id:"pages.agents.card.lastChat",defaultMessage:"\u6700\u8FD1\u5BF9\u8BDD"}),":"]}),(0,n.jsx)("span",{style:{marginLeft:8},children:e.lastChat})]}),e.conversationId&&(0,n.jsxs)("div",{style:{marginTop:8},children:[(0,n.jsxs)("span",{style:{color:"#666"},children:[p.formatMessage({id:"pages.agents.card.conversationId",defaultMessage:"\u4F1A\u8BDDID"}),":"]}),(0,n.jsx)("span",{style:{marginLeft:8,fontWeight:"bold"},children:e.conversationId}),(0,n.jsx)(f.default,{size:"small",danger:!0,style:{marginLeft:16},onClick:async()=>{try{await o.API.post(`/api/user/agent/clear_conversation/${e.id}`),v.default.success(p.formatMessage({id:"pages.agents.card.clearConversation.success",defaultMessage:"\u4F1A\u8BDDID\u5DF2\u6E05\u9664"})),s();}catch(e){v.default.error(p.formatMessage({id:"pages.agents.card.clearConversation.error",defaultMessage:"\u6E05\u9664\u4F1A\u8BDDID\u5931\u8D25"}));}},children:p.formatMessage({id:"pages.agents.card.clearConversation",defaultMessage:"\u6E05\u9664\u4F1A\u8BDDID"})})]}),(0,n.jsx)(h.default,{style:{margin:"12px 0"}}),(0,n.jsxs)(j.default,{wrap:!0,children:[(0,n.jsx)(f.default,{onClick:()=>l(`/console/agents/${e.id}/config`,{state:t||e}),children:p.formatMessage({id:"pages.agents.card.configRole",defaultMessage:"\u914D\u7F6E\u89D2\u8272"})}),(0,n.jsx)(f.default,{onClick:()=>v.default.info(p.formatMessage({id:"pages.agents.card.voiceRecognition.developing",defaultMessage:"\u529F\u80FD\u5F00\u53D1\u4E2D\uFF0C\u656C\u8BF7\u671F\u5F85"})),children:p.formatMessage({id:"pages.agents.card.voiceRecognition",defaultMessage:"\u58F0\u7EB9\u8BC6\u522B"})}),(0,n.jsx)(f.default,{onClick:()=>l(`/console/agents/${e.id}/history`,{state:e}),children:p.formatMessage({id:"pages.agents.card.historyDialog",defaultMessage:"\u5386\u53F2\u5BF9\u8BDD"})}),e.hasSettings?(0,n.jsx)(f.default,{onClick:()=>l(`/console/agents/${e.id}/device`),children:(0,n.jsxs)(j.default,{children:[(0,n.jsx)(I.default,{}),p.formatMessage({id:"pages.agents.card.manageDevice",defaultMessage:"\u7BA1\u7406\u8BBE\u5907"})," (",e.settingsCount,")"]})}):(0,n.jsx)(f.default,{type:"primary",onClick:()=>b(p),children:p.formatMessage({id:"pages.agents.card.addDevice",defaultMessage:"\u6DFB\u52A0\u8BBE\u5907"})})]})]}),(0,n.jsx)(d.default,{isOpen:g,onClose:()=>c(!1),onConfirm:()=>{c(!1),s();},agentID:e.id})]});},w=({isOpen:e,onClose:a,onConfirm:s})=>{let[t,l]=(0,r.useState)(""),d=(0,i.useIntl)();return e?(0,n.jsx)(y.default,{title:d.formatMessage({id:"pages.agents.create.modal.title",defaultMessage:"\u65B0\u5EFA\u667A\u80FD\u4F53"}),open:e,okButtonProps:{disabled:0==t.trim().length},onCancel:()=>{l(""),a();},onOk:()=>{t.trim()&&(s(t.trim()),l(""),a());},children:(0,n.jsx)(m.default.Item,{label:d.formatMessage({id:"pages.agents.create.modal.nameLabel",defaultMessage:"\u667A\u80FD\u4F53\u540D\u79F0"}),children:(0,n.jsx)(M.default,{value:t,onChange:e=>l(e.target.value),placeholder:d.formatMessage({id:"pages.agents.create.modal.placeholder",defaultMessage:"\u8BF7\u8F93\u5165\u667A\u80FD\u4F53\u540D\u79F0"})})})}):null;},D=(e,a,s)=>{var t;let n={1:s.formatMessage({id:"pages.agents.speed.patient",defaultMessage:"\u8010\u5FC3"}),2:s.formatMessage({id:"pages.agents.speed.normal",defaultMessage:"\u6B63\u5E38"}),3:s.formatMessage({id:"pages.agents.speed.fast",defaultMessage:"\u5FEB\u901F"})};return n[e.asrSpeed]||s.formatMessage({id:"pages.agents.speed.normal",defaultMessage:"\u6B63\u5E38"}),n[e.speakSpeed]||s.formatMessage({id:"pages.agents.speed.normal",defaultMessage:"\u6B63\u5E38"}),{id:Number(e.id),name:e.name,avatar:e.voice,voiceModel:e.LLM,lastChat:(e=>{if(!e)return s.formatMessage({id:"pages.agents.lastChat.none",defaultMessage:"\u65E0"});let a=(0,l.default)(e);return!a.isValid()||2020>a.year()?s.formatMessage({id:"pages.agents.lastChat.none",defaultMessage:"\u65E0"}):a.format("YYYY-MM-DD HH:mm");})(e.lastConversationAt),hasSettings:!!(e.deviceIDs&&e.deviceIDs.length>0),settingsCount:(null===(t=e.deviceIDs)||void 0===t?void 0:t.length)||0,conversationId:e.conversationId,updatedAt:e.updatedAt};};var L=()=>{let[e,a]=(0,r.useState)(!1),[s,t]=(0,r.useState)(!1),[l,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)(null),[M,v]=(0,r.useState)([]),[j,C]=(0,r.useState)([]),[_,A]=(0,r.useState)(!0),[I,L]=(0,r.useState)(""),T=(0,i.useIntl)(),P=async()=>{try{A(!0),L("");let[e,a]=await Promise.all([o.API.get("/api/user/agent/list"),(async()=>{try{return await g.systemApi.getProvidersByType("TTS");}catch(e){try{return await o.API.get("/api/user/providers/TTS"),[];}catch(e){return[];}}})()]),s=Array.isArray(a)?a:[],t=new Map;if(s.forEach(e=>{var a,s,n;let r=(null===(a=e.config)||void 0===a?void 0:a.supported_voices)||(null===(s=e.config)||void 0===s?void 0:s.surported_voices)||(null===(n=e.config)||void 0===n?void 0:n.supportedVoices)||null;Array.isArray(r)&&r.forEach(e=>{let a="string"==typeof e?e:(null==e?void 0:e.name)||"",s="string"==typeof e?e:(null==e?void 0:e.display_name_zh)||(null==e?void 0:e.display_name_cn)||(null==e?void 0:e.display_name)||(null==e?void 0:e.displayName)||(null==e?void 0:e.name)||a;if(a&&!t.has(a)){t.set(a,s);let e=String(a).toLowerCase().replace(/[_-\s]/g,"");e&&!t.has(e)&&t.set(e,s);}});}),console.log("\u6536\u5230\u7684list\u6D88\u606F:",e.data),"ok"===e.data.status){let a=Array.isArray(e.data.data)?e.data.data:[];C(a);let s=a.map((e,a)=>D(e,a,T)),n=e=>{if(!e)return e;if(t.has(e))return t.get(e);let a=String(e).toLowerCase().replace(/[_-\s]/g,"");for(let[e,s]of t.entries()){let t=String(e).toLowerCase().replace(/[_-\s]/g,"");if(t===a||t.includes(a)||a.includes(t)||(s||"").toLowerCase().includes(a))return s;}return e;},r=s.map(e=>({...e,avatar:n(e.avatar)}));v(r);}else L(T.formatMessage({id:"pages.agents.fetch.error",defaultMessage:"\u83B7\u53D6\u667A\u80FD\u4F53\u5217\u8868\u5931\u8D25"}));}catch(e){L(T.formatMessage({id:"pages.agents.network.error",defaultMessage:"\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5"}));}finally{A(!1);}};(0,r.useEffect)(()=>{P();},[]);let z=async e=>{try{let a="\u6E7E\u6E7E\u5C0F\u4F55",s="Qwen";try{let e=await g.systemApi.getProvidersByType("TTS"),s=new Map;e.forEach(e=>{var a,t,n;let r=(null===(a=e.config)||void 0===a?void 0:a.supported_voices)||(null===(t=e.config)||void 0===t?void 0:t.surported_voices)||(null===(n=e.config)||void 0===n?void 0:n.supportedVoices)||null;Array.isArray(r)&&r.forEach(e=>{let a="string"==typeof e?e:(null==e?void 0:e.name)||"",t="string"==typeof e?e:(null==e?void 0:e.display_name_zh)||(null==e?void 0:e.display_name_cn)||(null==e?void 0:e.display_name)||(null==e?void 0:e.displayName)||(null==e?void 0:e.name)||a;if(a&&!s.has(a)){s.set(a,t);let e=String(a).toLowerCase().replace(/[_-\s]/g,"");e&&!s.has(e)&&s.set(e,t);}});});let t=Array.from(s.keys());t.length>0&&(a=t.find(e=>e.includes("wanwanxiaohe")||e.includes("\u6E7E\u6E7E\u5C0F\u4F55")||(s.get(e)||"").includes("\u6E7E\u6E7E\u5C0F\u4F55"))||t[0]);}catch(e){console.error(T.formatMessage({id:"pages.agents.loading.tts.error",defaultMessage:"\u52A0\u8F7DTTS\u97F3\u8272\u5931\u8D25"}),e);}try{let e=await g.systemApi.getProvidersByType("LLM");Array.isArray(e)&&e.length>0&&(s=(e.find(e=>!/^qwen/i.test(e.name))||e[0]).name);}catch(e){console.error(T.formatMessage({id:"pages.agents.loading.llm.error",defaultMessage:"\u52A0\u8F7DLLM\u63D0\u4F9B\u8005\u5931\u8D25"}),e);}let t=JSON.stringify({prompt:"",name:e,LLM:s,language:"\u4E2D\u6587",voice:a,asrSpeed:2,speakSpeed:2,tone:50});await o.API.post("/api/user/agent/create",t,{headers:{"Content-Type":"application/json"}}),P();}catch(e){}},E=async e=>{if(e)try{await o.API.delete(`/api/user/agent/${e.id}`,{headers:{"Content-Type":"application/json"}}),P(),t(!1),m(null);}catch(e){}};return _?(0,n.jsxs)(c.PageContainer,{children:[(0,n.jsx)(S,{onCreateAgent:()=>a(!0),onAddDevice:()=>b(T)}),T.formatMessage({id:"pages.agents.loading",defaultMessage:"\u52A0\u8F7D\u667A\u80FD\u4F53\u5217\u8868\u4E2D..."}),(0,n.jsx)(d.default,{isOpen:l,onClose:()=>u(!1),onConfirm:()=>{u(!1),P();},agentID:0})]}):I?(0,n.jsxs)(c.PageContainer,{children:[(0,n.jsx)(S,{onCreateAgent:()=>a(!0),onAddDevice:()=>b(T)}),(0,n.jsx)("div",{children:I}),(0,n.jsx)(f.default,{onClick:P,children:T.formatMessage({id:"pages.agents.reload",defaultMessage:"\u91CD\u65B0\u52A0\u8F7D"})}),(0,n.jsx)(d.default,{isOpen:l,onClose:()=>u(!1),onConfirm:()=>{u(!1),P();},agentID:0})]}):(0,n.jsxs)(c.PageContainer,{children:[(0,n.jsx)(S,{onCreateAgent:()=>a(!0),onAddDevice:()=>b(T)}),(0,n.jsx)("div",{children:0===M.length?(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:T.formatMessage({id:"pages.agents.empty.title",defaultMessage:"\u6682\u65E0\u667A\u80FD\u4F53"})}),(0,n.jsx)(f.default,{onClick:()=>a(!0),children:T.formatMessage({id:"pages.agents.empty.createFirst",defaultMessage:"\u521B\u5EFA\u7B2C\u4E00\u4E2A\u667A\u80FD\u4F53"})})]}):(0,n.jsx)(x.default,{gutter:[16,16],children:M.map((e,a)=>(0,n.jsx)(p.default,{children:(0,n.jsx)(k,{agent:e,fullAgent:Array.isArray(j)?j[a]:void 0,onDelete:()=>{y.default.confirm({title:T.formatMessage({id:"pages.agents.delete.title",defaultMessage:"\u786E\u5B9A\u5220\u9664\u667A\u80FD\u4F53"}),content:T.formatMessage({id:"pages.agents.delete.content",defaultMessage:"\u5220\u9664\u667A\u80FD\u4F53\u540E\uFF0C\u8BE5\u667A\u80FD\u4F53\u6709\u5173\u914D\u7F6E\uFF08\u5305\u62EC\u8BBE\u5907\u76F8\u5173\u7684\u5BF9\u8BDD\u8BB0\u5F55\uFF09\u5C06\u65E0\u6CD5\u6062\u590D\u3002\u786E\u5B9A\u5220\u9664\u5417\uFF1F"}),okText:T.formatMessage({id:"pages.agents.delete.confirm",defaultMessage:"\u786E\u8BA4\u5220\u9664"}),okType:"danger",onOk:()=>{E(e);},onCancel(){}});},onRefresh:P})},e.id))})}),(0,n.jsx)(w,{isOpen:e,onClose:()=>a(!1),onConfirm:z}),(0,n.jsx)(d.default,{isOpen:l,onClose:()=>u(!1),onConfirm:()=>{u(!1),P();},agentID:0})]});};},a8e90e34:function(e,a,s){"use strict";s.d(a,"__esModule",{value:!0}),s.d(a,"API",{enumerable:!0,get:function(){return i;}});var t=s("777fffbe")._(s("795f1363")),n=s("1fc97d93"),r=s("9a7ec01c"),l=s("23f8e02c");let i=t.default.create({baseURL:r.ENV.API_BASE_URL});i.interceptors.request.use(e=>{let a=(0,l.authHeader)();return e.headers&&"function"==typeof e.headers.set?a.Authorization&&e.headers.set("Authorization",a.Authorization):e.headers&&a.Authorization&&(e.headers.Authorization=a.Authorization),e;},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>((0,n.showError)(e),Promise.reject(e)));}}]);
//# sourceMappingURL=fe237714-async.f1d192b9.js.map